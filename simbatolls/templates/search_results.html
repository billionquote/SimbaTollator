<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results for {{ search_query }}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summary Page</title>
    <!-- Bootstrap CSS for quick layout and responsiveness -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        .dashboard-container {
            padding-top: 20px;
            padding-bottom: 40px;
        }
        .dashboard-card {
            border: none;
            border-radius: 20px;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.2);
            transition: transform .2s;
            color: #fff;
        }
        .dashboard-card:hover {
            transform: scale(1.05);
            box-shadow: 0px 0px 25px rgba(0, 0, 0, 0.25);
        }
        .card-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        .card-text {
            font-size: 30px;
            font-weight: bold;
        }
        .bg-primary .card-icon, .bg-success .card-icon, .bg-info .card-icon {
            opacity: 0.7;
        }
    </style>
    <style>
        body, html {
            height: 100%;
            margin: 0;
        }
        .bg-video {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%; 
            min-height: 100%;
            z-index: -1; /* Ensure video stays in the background */
        }
        .overlay {
            position: fixed;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none; /* Initially hidden */
        }
        .container-custom {
            position: relative;
            z-index: 10; /* Stay on top of everything */
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #mainNavbar {
            box-shadow: 0 4px 6px -1px rgba(0,0,0,.1);
            background-color: #283890 !important; /* Custom navbar color */
        }
        .navbar-brand img {
            height: 30px; /* Adjust size as needed */
        }
        .navbar-nav .nav-link {
            transition: color 0.3s ease-in-out;
        }
        .navbar-nav .nav-link:hover, .navbar-nav .nav-link:focus {
            color: #a8a8ff !important; /* Highlight color */
        }
        .container-custom {
            margin-top: 2rem;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script>
        $(document).ready(function() {
            $('#mainNavbar').show(); // Ensure navbar is shown on page load
        });
    </script>

    <style>
        .contract-btn {
            background-color: #007bff; /* Bootstrap primary color */
            color: white;
            border: none;
            padding: 8px 15px;
        }
    
        .contract-btn:hover {
            background-color: #0056b3; /* Darker shade for hover */
            color: #ffffff;
            cursor: pointer;
        }
    
        .rounded-pill {
            border-radius: 50rem !important; /* Makes the buttons nicely rounded */
        }
    </style>
    <style>
        .btn-info, .btn-info:hover, .btn-info:focus {
            background-color: #0d6efd; /* A lighter shade of the navbar color for the button */
            border-color: #0d6efd; /* Ensuring the border matches the button color */
            color: white; /* White text color */
        }
    
        .btn-info:hover {
            background-color: #54B4D3; /* Slightly darker shade for hover effect */
            border-color: #54B4D3;
        }
        
        /* The rest of your existing CSS */
        .contract-btn {
            background-color: #007bff; /* Bootstrap primary color */
            color: white;
            border: none;
            padding: 8px 15px;
        }
    
        .contract-btn:hover {
            background-color: #0056b3; /* Darker shade for hover */
            color: #ffffff;
            cursor: pointer;
        }
    
        .rounded-pill {
            border-radius: 50rem !important; /* Makes the buttons nicely rounded */
        }
        
        /* Additional custom styles */
        .contract-number {
            font-weight: bold; /* Makes the number stand out */
            color: #007bff; /* Bootstrap primary color, or choose your own */
            padding-left: 10px;
        }
        
    </style>
    
    
</head>
<body>
    <nav id="mainNavbar" class="navbar navbar-expand-lg navbar-dark fixed-top">
        <a class="navbar-brand" href="/">
            <img src="{{ url_for('static', filename='assets/logo/simba.png') }}" alt="Simba Logo">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
                <a class="nav-item nav-link" href="/">Upload Files</a>
                <a class="nav-item nav-link" href="/summary">Summary</a>
                <a class="nav-item nav-link active" href="/search">Search Results</a>
            </div>
        </div>
    </nav>


    <div class="container mt-5 text-center">
        <img src="{{ url_for('static', filename='assets/images/brand/simba.jpeg') }}" alt="Simba Logo" class="img-fluid mb-3" style="max-width: 200px; margin-top: 100px; margin-bottom: 100px">
        <div class="mt-3 text-center">
            <h4>Recent Contracts</h4>
            <div class="d-flex flex-wrap justify-content-center" style="gap: 10px; margin-top: 50px; margin-bottom: 50px">
                {% for contract in last_5_contracts %}
                <form action="{{ url_for('search') }}" method="POST">
                    <input type="hidden" name="search_query" value="{{ contract }}">
                    <button type="submit" class="btn rounded-pill contract-btn">{{ contract }}</button>
                </form>
                {% endfor %}
            </div>
        </div>
    </div>
    
    
    <div class="container mt-5 text-center">
        
        <!-- Search Bar -->
        <form action="{{ url_for('search') }}" method="POST" class="input-group mb-3">
            <input type="text" name="search_query" class="form-control" placeholder="Search Contract Number" aria-label="Search Contract Number" aria-describedby="button-search">
            <div class="input-group-append">
                <button class="btn btn-primary" type="submit" id="button-search">Search</button>
            </div>
        </form>
        
        <!-- Summary Record -->
       
    {% if search_query is not none and search_query|length > 0 %}
        {% if summary_record %}
            
            <h3>Summary Record: <span class="contract-number">{{ search_query }}</span></h3>
        

            <!-- Copy Button for Summary -->
            <button class="btn btn-primary mb-2" id="copySummaryBtn">Copy Summary Info</button>
            <div class="table-responsive">
                <table class="table table-bordered" id="summaryTable">
                    <thead>
                        <tr>
                            <th>Contract Number</th>
                            <th>Pickup Date Time</th>
                            <th>Dropoff Date Time</th>
                            <th>Num of Tolls Used</th>
                            <th>Admin Fee</th>
                            <th>Sum of Toll Cost</th>
                            <th>Total Contract Toll Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in summary_record %}
                        <tr>
                            <td>{{ record['contract_number'] }}</td>
                            <td>{{ record['pickup_date_time'] }}</td>
                            <td>{{ record['dropoff_date_time'] }}</td>
                            <td>{{ record['num_of_rows'] }}</td>
                            <td>${{ record['admin_fee']|format('{:,.2f}') }}</td>
                            <td>${{ record['sum_of_toll_cost']|format('{:,.2f}') }}</td>
                            <td>${{ record['total_toll_contract_cost']|format('{:,.2f}') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>No summary record found.</p>
        {% endif %}
    {% endif %}
        <!-- Toll Records -->
        
    {% if search_query is not none and search_query|length > 0 %}
        {% if raw_records %}
        <h3>Toll Records</h3>
            <!-- Copy Button for Raw Records -->
            <button class="btn btn-primary mb-2" id="copyRawBtn">Copy Raw Table</button>
            <div class="table-responsive">
                <table class="table table-bordered" id="rawTable">
                    <thead>
                        <tr>
                            {% for key in raw_records[0].keys() %}
                                <th>{{ key }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in raw_records %}
                            <tr>
                                {% for value in record.values() %}
                                    <td>{{ value }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>No raw records found.</p>
        {% endif %}
    {% endif %}
    </div>
     </div>
    <script>
        // Function to copy plain text to clipboard
        function copyTextToClipboard(text) {
        navigator.clipboard.writeText(text).then(function() {
            console.log('Text copied to clipboard');
        }, function(err) {
            console.error('Could not copy text: ', err);
        });
    }

    function formatDateTime(dateTimeStr) {
        // Modify this function if needed to format date-time strings
        return dateTimeStr.replace(/:\d\d(?=:|$)/g, '');
    }

    document.getElementById('copySummaryBtn').addEventListener('click', function() {
        // Assuming there's only one row in the summary table
        const row = document.querySelector('#summaryTable tbody tr');
        const contractNumber = row.cells[0].innerText;
        const pickUp = row.cells[1].innerText;
        const dropOff = row.cells[2].innerText;
        const rowNum = row.cells[3].innerText;
        const adminFee = row.cells[4].innerText;
        const tollCost = row.cells[5].innerText;
        const totalCost = row.cells[6].innerText;

        const sentence = `Contract Number ${contractNumber} was picked up on ${pickUp} and returned on ${dropOff}. A total of ${rowNum} toll(s) were used. The Admin Fee is ${adminFee}, the Toll Cost is ${tollCost}, and the Total Toll Contract Cost is ${totalCost}.`;
        copyTextToClipboard(sentence);

        this.textContent = 'Copied'; // Optionally change the button text to 'Copied'
    });

    document.getElementById('copyRawBtn').addEventListener('click', function() {
        // Your existing code for copying the raw table
    });
    
        // Function to remove seconds from time strings
        function formatDateTime(dateTimeStr) {
            return dateTimeStr.replace(/:\d\d(?=:|$)/g, '');
        }
    
        // Function to format and copy the table content as plain text
        function copyTableText(tableId) {
            const table = document.getElementById(tableId);
            let textToCopy = '';
            let columnWidths = Array.from(table.rows[0].cells).map(cell => formatDateTime(cell.innerText).length);
    
            // Update columnWidths based on the longest content in each column
            for (const row of table.rows) {
                Array.from(row.cells).forEach((cell, index) => {
                    const cellLength = formatDateTime(cell.innerText).length;
                    if (cellLength > columnWidths[index]) {
                        columnWidths[index] = cellLength;
                    }
                });
            }
    
            // Generate textToCopy with padding for each cell to align columns
            for (const row of table.rows) {
                let rowData = Array.from(row.cells).map((cell, index) => 
                    formatDateTime(cell.innerText).padEnd(columnWidths[index], ' ')
                );
                textToCopy += rowData.join('   ') + '\n'; // Adjust spacing as needed
            }
    
            copyTextToClipboard(textToCopy);
        }
    
        // Event listener for the "Copy Raw Table" button
        document.getElementById('copyRawBtn').addEventListener('click', function() {
            copyTableText('rawTable');
            this.textContent = 'Copied'; // Change button text to 'Copied'
        });
    
        // Ensure other parts of your script remain unchanged
    </script>
    
    
    
    